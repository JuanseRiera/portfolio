import {
	useStyles$,
	useStylesScoped$,
	component$,
	useVisibleTask$,
} from "@builder.io/qwik";
import styles from "./avatar.css?inline";

export const Avatar = component$(() => {
	useStylesScoped$(styles);
	useStyles$(styles);

	// eslint-disable-next-line qwik/no-use-visible-task
	useVisibleTask$(() => {
    
		const avatar = document.querySelector<HTMLElement>("#avatar");
		const head = document.querySelector<HTMLElement>("#head");
		const leftEye = document.querySelector<HTMLElement>("#leftEye");
		const rightEye = document.querySelector<HTMLElement>("#rightEye");
		const leftEyebrow = document.querySelector<HTMLElement>("#leftEyebrow");
		const rightEyebrow = document.querySelector<HTMLElement>("#rightEyebrow");
		const maxEyebrowMovement = 5;

		if (!head || !leftEye || !rightEye || !leftEyebrow || !rightEyebrow || !avatar) return;

		const headRect = head.getBoundingClientRect();
		const headCenterPosition = {
			x: headRect.left + headRect.width / 2,
			y: headRect.top + headRect.height / 2,
		};

		const getAngle = (
			mouseX: number,
			mouseY: number,
			headX: number,
			headY: number
		) => {
			const dy = headY - mouseY;
			const dx = headX - mouseX;
			return Math.atan2(dy, dx);
		};

		const getLeftSideFactor = (mouseX: number) => {
			// From the left till the center of the head is giving a factor that goes from 1 to 0
			return (mouseX - headCenterPosition.x) / headCenterPosition.x;
		};

		const getRightSideFacor = (mouseX: number) => {
			// From the center of the head till the end of the viewport is giving a factor that goes from 0 to 1
			return (
				(mouseX - headCenterPosition.x) /
				(window.innerWidth - headCenterPosition.x)
			);
		};

		document.addEventListener("mousemove", (e) => {
			const angle =
				getAngle(
					e.clientX,
					e.clientY,
					headCenterPosition.x,
					headCenterPosition.y
				) + 4.71239;

			leftEye.style.transform = `rotate(${angle}rad)`;
			rightEye.style.transform = `rotate(${angle}rad)`;

			const eyebrowMovement =
				(e.clientX < headCenterPosition.x
					? getLeftSideFactor(e.clientX)
					: getRightSideFacor(e.clientX)) * maxEyebrowMovement;

			leftEyebrow.style.transform = ` translateY(${eyebrowMovement}px)`;
			rightEyebrow.style.transform = ` translateY(${-eyebrowMovement}px)`;
		});
	});

	return (
		<div id="avatar" class="avatar">
			<svg
				id="head"
				class="avatar__head"
				viewBox="0 0 302 419"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<g id="hair">
					<path
						d="M207.804 103.56C233.654 111.98 260.804 126.12 278.464 141.79C277.594 139.18 276.624 136.67 275.754 134.25C276.434 134.92 278.33 134.85 279 135.5C277.894 129.04 275.098 123.399 273.254 117.11C282.936 120.655 292.35 124.893 301.424 129.79C286.904 89.43 262.224 66.3 233.424 54.69C247.675 55.4482 261.78 57.9502 275.424 62.14C249.044 15.71 208.874 5.81 169.484 12.49C174.034 9.39 179.254 6.1 184.964 2.62C153.124 -0.0899973 129.124 8.52 111.314 20.81C116.314 15.3 122.314 6.49 129.314 0C39.1136 13.84 19.1736 92 15.0136 113.24C10.2436 132.57 30.4936 143.34 30.4936 143.34C30.4936 143.34 70.1735 121.18 125.834 109.66C151.474 113.53 178.284 119.66 194.544 134.15C191.152 123.338 186.679 112.895 181.194 102.98C189.904 102.89 198.804 102.98 207.804 103.56Z"
						class="svg-stroke svg-fill-secondary"
					/>
					<path
						d="M276 203C285.792 194.19 288 145.975 288 145.975L278.834 144C278.834 144 277.696 170.445 276 203Z"
						class="svg-stroke svg-fill-secondary"
					/>
					<path
						d="M29 143L13.0716 145.786C13.0716 145.786 11.5625 195.337 22.3989 206C25.9818 170.461 29 143 29 143Z"
						class="svg-stroke svg-fill-secondary"
					/>
				</g>
				<g id="ears">
					<path
						class="svg-stroke"
						d="M29 277.698L23.0216 283.018C20.0076 285.124 16.68 284.86 13.7675 282.285C10.8549 279.71 8.59484 275.033 7.4821 269.278C5.8136 260.758 2.47138 243.628 0.802878 235.018C0.233258 232.178 -0.0381017 229.152 0.004303 226.112C0.0467077 223.071 0.40204 220.077 1.05001 217.299C1.69798 214.521 2.62588 212.015 3.78068 209.923C4.93548 207.832 6.29456 206.195 7.78024 205.108L11.2218 202.688C15.8821 199.298 19.4754 201.048 22.7287 207.628"
					/>
					<path
						class="svg-stroke"
						d="M11.7867 251.108C8.64844 260.408 15.4061 268.868 18.6176 262.728C23.7852 252.848 15.0086 231.558 8.64844 231.558"
					/>
					<path
						class="svg-stroke"
						d="M274.045 207.241C277.176 201.045 280.646 199.397 285.155 202.59L288.483 204.868C289.918 205.891 291.231 207.431 292.347 209.4C293.462 211.37 294.359 213.73 294.985 216.345C295.611 218.961 295.954 221.781 295.996 224.644C296.037 227.507 295.775 230.358 295.225 233.032C293.614 241.14 290.387 257.27 288.776 265.293C287.701 270.712 285.518 275.116 282.705 277.541C279.892 279.965 276.678 280.214 273.767 278.231L268 273.221"
					/>
					<path
						class="svg-stroke"
						d="M287.634 229.746C281.493 229.746 273.019 249.793 278.004 259.097C281.109 264.878 287.634 256.912 284.604 248.155"
					/>
				</g>
				<g id="eyebrows">
					<path
						id="leftEyebrow"
						class="svg-fill-secondary svg-stroke"
						d="M119.11 165.532L118.11 171.342C117.964 172.08 117.647 172.775 117.184 173.368C116.72 173.961 116.124 174.437 115.442 174.758C114.761 175.078 114.014 175.233 113.261 175.212C112.509 175.19 111.772 174.991 111.11 174.632C98.43 167.862 65.62 156.442 33 189.832C34.65 172.212 61.26 142.602 116 160.602C117.034 160.897 117.923 161.563 118.497 162.472C119.071 163.382 119.289 164.471 119.11 165.532Z"
					/>
					<path
						id="rightEyebrow"
						class="svg-fill-secondary svg-stroke"
						d="M173.035 165.897L173.815 171.707C173.922 172.445 174.202 173.148 174.632 173.758C175.062 174.368 175.631 174.868 176.29 175.217C176.95 175.566 177.683 175.754 178.429 175.766C179.176 175.778 179.914 175.614 180.585 175.287C193.585 169.087 237.985 156.117 268.955 191.057C265.665 155.927 224.815 147.607 176.235 161.157C175.217 161.423 174.33 162.051 173.741 162.923C173.152 163.796 172.901 164.853 173.035 165.897Z"
					/>
				</g>
				<g id="glasses">
					<path
						class="svg-stroke svg-fill-secondary"
						d="M260.079 200.428C232.169 197.191 203.861 197.191 175.951 200.428C167.909 201.36 161.815 206.874 160.414 213.598C156.799 211.523 152.546 210.284 148 210.284C143.453 210.284 139.2 211.523 135.586 213.598C134.183 206.873 128.09 201.36 120.049 200.428C92.1387 197.191 63.831 197.191 35.921 200.428C26.0239 201.576 18.9389 209.645 20.1309 218.412C20.7737 223.137 21.4211 227.716 22.064 232.303C23.3451 241.393 24.6262 250.512 25.9119 260.815C27.2068 271.133 36.961 278.949 48.6214 279H107.367C107.376 279 107.384 279 107.393 279C119.023 278.941 128.768 271.121 130.063 260.811C131.349 250.468 132.639 241.318 133.92 232.192C134.123 230.754 134.324 229.281 134.526 227.84C134.582 227.708 134.678 227.599 134.719 227.459C136.277 222.106 141.737 218.368 148 218.368C154.254 218.368 159.714 222.099 161.276 227.439C161.314 227.569 161.415 227.662 161.466 227.786C161.671 229.244 161.874 230.737 162.08 232.192C163.361 241.318 164.651 250.468 165.937 260.814C167.232 271.133 176.986 278.948 188.651 278.999H247.396C247.405 278.999 247.414 278.999 247.423 278.999C259.053 278.94 268.793 271.12 270.088 260.81C271.374 250.511 272.655 241.393 273.936 232.302C274.579 227.715 275.226 223.136 275.869 218.411C277.062 209.645 269.977 201.577 260.079 200.428ZM120.974 259.922C120.193 266.151 114.34 270.872 107.353 270.916H48.6443C41.6489 270.888 35.7827 266.159 35.0016 259.926C33.7113 249.584 32.421 240.43 31.1399 231.308C30.4925 226.729 29.8496 222.158 29.2113 217.448C28.6131 213.055 32.1576 209.017 37.1084 208.441C50.6751 206.87 64.327 206.084 77.9875 206.084C91.6433 206.084 105.304 206.87 118.862 208.441C123.817 209.017 127.362 213.055 126.759 217.448C126.125 222.118 125.486 226.654 124.848 231.197C123.558 240.359 122.269 249.545 120.974 259.922ZM266.79 217.449C266.151 222.158 265.509 226.729 264.861 231.308C263.58 240.431 262.29 249.585 260.999 259.923C260.218 266.152 254.366 270.873 247.384 270.916H188.674C181.674 270.889 175.808 266.16 175.027 259.927C173.732 249.545 172.443 240.359 171.152 231.198C170.514 226.655 169.876 222.119 169.241 217.445C168.639 213.056 172.183 209.018 177.139 208.442C190.701 206.871 204.357 206.085 218.013 206.085C231.669 206.085 245.33 206.871 258.892 208.442C263.843 209.017 267.387 213.056 266.79 217.449Z"
					/>
				</g>
				<g id="beard">
					<path
						class="svg-stroke svg-fill-secondary"
						fill-rule="evenodd"
						clip-rule="evenodd"
						d="M76.7987 339.608C75.2825 342.774 74.1207 346.061 73.274 349.453C42.871 316.697 46.5138 324.926 43.1664 282.672L27 273C27.5513 329.605 43.0681 374.016 115.653 412.685C126.873 417.976 151.838 420.107 162.065 416.918C202.787 404.219 257.676 366.283 265.864 330.673C270 312.683 270 295.752 270 273L252.817 283.107C249.942 324.369 252.581 316.384 223.714 349.019C214.971 318.42 155.13 307.519 147.962 319C136.463 305.797 84.4782 323.604 76.7987 339.608ZM99.5615 359.821C100.704 353.002 104.071 348.584 107.339 344.356C113.66 336.198 117.658 336.737 126.873 338.007C143.335 340.286 159.698 339.816 175.923 336.702C186.517 336.563 197.387 352.95 196.304 360.552C195.28 367.719 179.724 376.295 171.414 376.243C163.991 376.208 156.173 372.676 147.962 365.544C131.343 380.626 114.31 378.974 99.5615 359.821Z"
					/>
				</g>
				<g id="nose">
					<path
						class="svg-stroke"
						d="M137.296 248V262.5L135.605 270.028C135.535 270.341 135.416 270.64 135.251 270.914L132.5 275.5L129 281.5C128.591 288.036 131.516 293.786 137.296 296.106C139.888 298.623 143.143 300 146.503 300C149.862 300 153.117 298.623 155.709 296.106C161.434 293.808 165.384 288.112 164.97 281.576"
					/>
				</g>
				<g id="eyes">
					<path
						id="leftEyeContainer"
						class="svg-stroke"
						d="M112.839 247.551C112.838 247.798 112.836 247.991 112.823 248.136L112.516 248.043L112.442 248.631L112.245 250.191L111.361 250.244L111.32 250.247L111.28 250.256L108.803 250.82L108.786 250.824L108.77 250.829L108.77 250.829L108.769 250.829L108.762 250.831L108.736 250.839C108.713 250.846 108.677 250.856 108.629 250.87C108.534 250.897 108.392 250.938 108.204 250.989C107.828 251.092 107.271 251.24 106.548 251.417C105.102 251.772 102.995 252.246 100.356 252.72C95.0758 253.669 87.6702 254.617 79.171 254.617C70.7876 254.617 63.851 250.861 58.9911 247.076C56.5637 245.185 54.6633 243.294 53.3706 241.876C52.7245 241.167 52.2308 240.578 51.8997 240.167C51.7674 240.003 51.6611 239.867 51.5814 239.764C55.0963 232.449 61.3375 228.388 67.9183 226.15C74.5866 223.882 81.5653 223.5 86.301 223.5C91.944 223.5 96.7968 225.181 101.126 229.011C105.457 232.842 109.29 238.848 112.839 247.551ZM112.787 248.347C112.787 248.349 112.786 248.35 112.786 248.35C112.786 248.35 112.786 248.349 112.787 248.347Z"
					/>
					<g id="leftEye">
						<path d="M82 254.617C73.4396 254.617 66.5 247.678 66.5 239.117C66.5 230.557 73.4396 223.617 82 223.617C90.5604 223.617 97.5 230.557 97.5 239.117C97.5 247.678 90.5604 254.617 82 254.617Z" />
						<path
							id="leftPupil"
							class="svg-fill-primary svg-stroke"
							d="M88 233C88 236.314 85.3137 239 82 239C78.6863 239 76 236.314 76 233C76 229.686 78.6863 227 82 227C85.3137 227 88 229.686 88 233Z"
						/>
					</g>

					<path
						id="rightEyeContainer"
						class="svg-stroke"
						d="M186.5 247.551C186.5 247.798 186.503 247.991 186.516 248.136L186.822 248.043L186.897 248.631L187.093 250.191L187.978 250.244L188.019 250.247L188.059 250.256L190.536 250.82L190.552 250.824L190.569 250.829L190.569 250.829L190.57 250.829L190.577 250.831L190.603 250.839C190.626 250.846 190.662 250.856 190.709 250.87C190.805 250.897 190.947 250.938 191.135 250.989C191.511 251.092 192.068 251.24 192.791 251.417C194.236 251.772 196.344 252.246 198.983 252.72C204.263 253.669 211.669 254.617 220.168 254.617C228.551 254.617 235.488 250.861 240.348 247.076C242.775 245.185 244.676 243.294 245.968 241.876C246.614 241.168 247.108 240.578 247.439 240.167C247.571 240.003 247.678 239.867 247.757 239.764C244.243 232.449 238.001 228.388 231.421 226.15C224.752 223.882 217.774 223.5 213.038 223.5C207.395 223.5 202.542 225.181 198.213 229.011C193.882 232.842 190.049 238.848 186.5 247.551ZM186.552 248.347C186.552 248.349 186.553 248.35 186.553 248.35C186.553 248.349 186.552 248.349 186.552 248.347Z"
					/>
					<g id="rightEye">
						<path d="M217.339 254.617C208.779 254.617 201.839 247.678 201.839 239.117C201.839 230.557 208.779 223.617 217.339 223.617C225.9 223.617 232.839 230.557 232.839 239.117C232.839 247.678 225.9 254.617 217.339 254.617Z" />
						<path
							id="rightPupil"
							class="svg-fill-primary svg-stroke"
							d="M223 233C223 236.314 220.314 239 217 239C213.686 239 211 236.314 211 233C211 229.686 213.686 227 217 227C220.314 227 223 229.686 223 233Z"
						/>
					</g>
				</g>
			</svg>

			<svg
				id="body"
				class="avatar__body"
				viewBox="0 0 465 195"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					class="svg-fill-secondary"
					d="M463.53 143.13C463.53 143.13 461.29 89.78 408.1 81.13C354.1 72.35 322.1 59.51 314.37 56.2C315.37 74.2 262.37 117.4 233.74 117.4H233.53C204.64 117.4 151 73.47 152.94 55.73C147.69 58.07 115.12 71.87 58.1502 81.13C4.95021 89.79 2.72021 143.13 2.72021 143.13L3.31021 159.8C3.35656 161.106 3.71957 162.382 4.36801 163.517C5.01645 164.652 5.93091 165.613 7.03274 166.316C8.13456 167.019 9.39076 167.445 10.6933 167.555C11.9958 167.665 13.3057 167.458 14.5102 166.95C45.3702 153.95 138 123.04 233.12 171.95C313.12 213.03 413.12 188.41 450.04 176.95C454.215 175.65 457.848 173.014 460.377 169.447C462.907 165.88 464.194 161.58 464.04 157.21L463.53 143.13Z"
				/>
				<g id="shoulders">
					<path
						class="svg-stroke"
						d="M303.95 44.2C303.95 44.2 337.9 59.8 401.8 69.95C456.26 78.61 458.55 131.95 458.55 131.95"
					/>
					<path
						class="svg-stroke"
						d="M154.6 44.2C154.6 44.2 120.6 59.8 56.75 69.95C2.28999 78.61 0 131.95 0 131.95"
					/>
				</g>

				<g id="neck">
					<path
						class="svg-stroke"
						d="M167.74 0.0100098C162.51 24.69 152.35 51.08 152.35 51.08C149.16 67.08 200.84 108.67 228.52 108.67H228.72C256.4 108.67 308.08 67.05 304.89 51.08C304.89 51.08 294.73 24.69 289.51 0"
					/>
					<path
						class="svg-stroke"
						d="M210.53 47.38C215.62 51.5703 222.008 53.8614 228.6 53.8614C235.193 53.8614 241.581 51.5703 246.67 47.38"
					/>
				</g>
			</svg>
		</div>
	);
});
